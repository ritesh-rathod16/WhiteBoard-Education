<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhiteBoard Education | Interactive Online Whiteboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="https://media-hosting.imagekit.io/60e464277ec54440/Whiteboard%20Education%20Logo.png">
    <style>
        :root {
            --primary-color: #4a6bff;
            --primary-dark: #3a56cc;
            --secondary-color: #6c757d;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --white: #ffffff;
            --gray-light: #e9ecef;
            --gray: #adb5bd;
            --gray-dark: #495057;
            --sidebar-width: 350px;
            --toolbar-height: 60px;
            --header-height: 70px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--dark-color);
            line-height: 1.6;
            overflow: hidden;
            height: 100vh;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background-color: var(--white);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        /* Header Styles */
        .header {
            height: var(--header-height);
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: var(--white);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo img {
            height: 40px;
            margin-right: 10px;
        }

        .logo span {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-menu {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        .header-menu a {
            text-decoration: none;
            color: var(--dark-color);
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .header-menu a:hover {
            color: var(--primary-color);
        }

        /* Main Whiteboard Layout */
        .whiteboard-container {
            display: flex;
            height: calc(100vh - var(--header-height));
            margin-top: var(--header-height);
        }

        /* Left Toolbar */
        .toolbar {
            width: 60px;
            background-color: var(--white);
            border-right: 1px solid var(--gray-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 0;
            z-index: 10;
        }

        .tool-group {
            margin-bottom: 20px;
            width: 100%;
        }

        .tool-group-title {
            font-size: 0.7rem;
            text-align: center;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .tool-btn {
            width: 100%;
            padding: 10px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            color: var(--gray-dark);
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .tool-btn:hover {
            color: var(--primary-color);
            background-color: rgba(74, 107, 255, 0.05);
        }

        .tool-btn.active {
            color: var(--primary-color);
            border-left: 3px solid var(--primary-color);
            background-color: rgba(74, 107, 255, 0.1);
        }

        .tool-btn i {
            font-size: 1.2rem;
            margin-bottom: 3px;
        }

        .tool-btn span {
            font-size: 0.7rem;
        }

        /* Whiteboard Canvas */
        .whiteboard {
            flex: 1;
            background-color: #f5f5f5;
            overflow: hidden;
            position: relative;
        }

        #canvas {
            background-color: white;
            cursor: crosshair;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            position: absolute;
        }

        /* Right Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--white);
            border-left: 1px solid var(--gray-light);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-title {
            font-weight: 600;
        }

        .sidebar-close {
            cursor: pointer;
            color: var(--gray);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        /* Video Chat Section */
        .video-container {
            margin-bottom: 20px;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .video-item {
            background-color: var(--light-color);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            aspect-ratio: 16/9;
        }

        .video-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .video-control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .video-control-btn:hover {
            background-color: var(--gray);
            color: white;
        }

        /* Chat Section */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: calc(100% - 200px);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding-right: 5px;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--gray-light);
            margin-right: 10px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .message-content {
            flex: 1;
        }

        .message-header {
            display: flex;
            align-items: baseline;
            margin-bottom: 5px;
        }

        .message-sender {
            font-weight: 600;
            margin-right: 8px;
        }

        .message-time {
            font-size: 0.7rem;
            color: var(--gray);
        }

        .message-text {
            background-color: var(--light-color);
            padding: 8px 12px;
            border-radius: 0 10px 10px 10px;
            font-size: 0.9rem;
        }

        .message.me {
            flex-direction: row-reverse;
        }

        .message.me .message-avatar {
            margin-right: 0;
            margin-left: 10px;
        }

        .message.me .message-text {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 0 10px 10px;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--gray-light);
            border-radius: 20px;
            outline: none;
        }

        .chat-input button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
        }

        /* Tool Options Panel */
        .tool-options {
            position: absolute;
            top: 80px;
            left: 80px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 15px;
            z-index: 100;
            display: none;
        }

        .tool-options.active {
            display: block;
        }

        .option-group {
            margin-bottom: 15px;
        }

        .option-title {
            font-size: 0.8rem;
            color: var(--gray-dark);
            margin-bottom: 8px;
        }

        .option-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .color-option.selected {
            border-color: var(--dark-color);
        }

        .size-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: black;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .size-option.selected {
            background-color: var(--primary-color);
        }

        .font-option {
            padding: 4px 8px;
            border-radius: 4px;
            background-color: var(--light-color);
            cursor: pointer;
            font-size: 0.8rem;
        }

        .font-option.selected {
            background-color: var(--primary-color);
            color: white;
        }

        /* Whiteboard Elements */
        .whiteboard-element {
            position: absolute;
            cursor: move;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .sidebar {
                position: absolute;
                top: var(--header-height);
                right: 0;
                bottom: 0;
                transform: translateX(100%);
                z-index: 1000;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .header-menu {
                display: none;
            }
        }

        @media (max-width: 576px) {
            .toolbar {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 60px;
                width: 100%;
                flex-direction: row;
                justify-content: space-around;
                padding: 0;
                z-index: 1000;
            }

            .tool-group {
                margin-bottom: 0;
                display: flex;
            }

            .tool-group-title {
                display: none;
            }

            .tool-btn {
                padding: 10px;
                border-left: none;
                border-top: 3px solid transparent;
            }

            .tool-btn.active {
                border-left: none;
                border-top: 3px solid var(--primary-color);
            }

            .whiteboard {
                margin-bottom: 60px;
            }

            .tool-options {
                top: auto;
                bottom: 70px;
                left: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <img src="https://media-hosting.imagekit.io/60e464277ec54440/Whiteboard%20Education%20Logo.png?Expires=1841428255&Key-Pair-Id=K2ZIVPTIP2VGHC&Signature=uYLBWzU91ZxyyogxB-wMLWkJFy00qoo4ox9pYL0GwLROPD5pADr8A8foBrUpGYblgg9YddhLR-auVRB4M94vwaNK5dOQ8wSdnpnWChFg2nE55TK~s6nYoOAmW9wJuijohn8ywybVXlm5o4G1h02fm1U4zI6Iro~7RtweKN~KXoxBRotZ0c4~A-rQk1IbTns9rr6Nt-nX2aR~juqqCgQxoza~4z3A3Mb7eJ0st2G1KJ0aBVyEedf6aKSTQWlbn7CkXj7TK9RooKfvXsqVsaThOWdT3eD6uU6ZqRdK9rQKJo-VzG4h0MPLSw1Li74LyBf09g28DsueYt4n2zz5Y593OQ__" alt="WhiteBoard Education Logo">
            <span>WhiteBoard Education</span>
        </div>
        <ul class="header-menu">
            <li><a href="#">File</a></li>
            <li><a href="#">Edit</a></li>
            <li><a href="#">View</a></li>
            <li><a href="#">Help</a></li>
        </ul>
        <div class="header-actions">
            <button class="btn btn-secondary">Share</button>
            <button class="btn btn-primary">Save</button>
        </div>
    </header>

    <!-- Main Whiteboard Container -->
    <div class="whiteboard-container">
        <!-- Left Toolbar -->
        <div class="toolbar">
            <div class="tool-group">
                <div class="tool-group-title">Tools</div>
                <div class="tool-btn active" data-tool="select">
                    <i class="fas fa-mouse-pointer"></i>
                    <span>Select</span>
                </div>
                <div class="tool-btn" data-tool="pen">
                    <i class="fas fa-pen"></i>
                    <span>Pen</span>
                </div>
                <div class="tool-btn" data-tool="highlighter">
                    <i class="fas fa-highlighter"></i>
                    <span>Highlighter</span>
                </div>
                <div class="tool-btn" data-tool="eraser">
                    <i class="fas fa-eraser"></i>
                    <span>Eraser</span>
                </div>
                <div class="tool-btn" data-tool="text">
                    <i class="fas fa-font"></i>
                    <span>Text</span>
                </div>
            </div>

            <div class="tool-group">
                <div class="tool-group-title">Shapes</div>
                <div class="tool-btn" data-tool="line">
                    <i class="fas fa-slash"></i>
                    <span>Line</span>
                </div>
                <div class="tool-btn" data-tool="rectangle">
                    <i class="fas fa-square"></i>
                    <span>Rectangle</span>
                </div>
                <div class="tool-btn" data-tool="circle">
                    <i class="fas fa-circle"></i>
                    <span>Circle</span>
                </div>
                <div class="tool-btn" data-tool="arrow">
                    <i class="fas fa-arrow-right"></i>
                    <span>Arrow</span>
                </div>
                <div class="tool-btn" data-tool="triangle">
                    <i class="fas fa-play"></i>
                    <span>Triangle</span>
                </div>
            </div>

            <div class="tool-group">
                <div class="tool-group-title">Media</div>
                <div class="tool-btn" data-tool="image">
                    <i class="fas fa-image"></i>
                    <span>Image</span>
                </div>
                <div class="tool-btn" data-tool="sticky">
                    <i class="fas fa-sticky-note"></i>
                    <span>Note</span>
                </div>
                <div class="tool-btn" data-tool="document">
                    <i class="fas fa-file-alt"></i>
                    <span>Document</span>
                </div>
            </div>

            <div class="tool-group">
                <div class="tool-group-title">View</div>
                <div class="tool-btn" data-tool="zoom-in">
                    <i class="fas fa-search-plus"></i>
                    <span>Zoom In</span>
                </div>
                <div class="tool-btn" data-tool="zoom-out">
                    <i class="fas fa-search-minus"></i>
                    <span>Zoom Out</span>
                </div>
                <div class="tool-btn" data-tool="hand">
                    <i class="fas fa-hand-paper"></i>
                    <span>Hand</span>
                </div>
            </div>
        </div>

        <!-- Whiteboard Canvas -->
        <div class="whiteboard">
            <canvas id="canvas"></canvas>
            
            <!-- Tool Options Panel -->
            <div class="tool-options" id="pen-options">
                <div class="option-group">
                    <div class="option-title">Color</div>
                    <div class="option-row">
                        <div class="color-option selected" style="background-color: #000000;" data-color="#000000"></div>
                        <div class="color-option" style="background-color: #ff0000;" data-color="#ff0000"></div>
                        <div class="color-option" style="background-color: #00ff00;" data-color="#00ff00"></div>
                        <div class="color-option" style="background-color: #0000ff;" data-color="#0000ff"></div>
                        <div class="color-option" style="background-color: #ffff00;" data-color="#ffff00"></div>
                        <div class="color-option" style="background-color: #ff00ff;" data-color="#ff00ff"></div>
                    </div>
                </div>
                <div class="option-group">
                    <div class="option-title">Size</div>
                    <div class="option-row">
                        <div class="size-option selected" data-size="2"><span style="font-size: 6px;">•</span></div>
                        <div class="size-option" data-size="4"><span style="font-size: 8px;">•</span></div>
                        <div class="size-option" data-size="6"><span style="font-size: 10px;">•</span></div>
                        <div class="size-option" data-size="8"><span style="font-size: 12px;">•</span></div>
                        <div class="size-option" data-size="10"><span style="font-size: 14px;">•</span></div>
                    </div>
                </div>
            </div>

            <div class="tool-options" id="text-options">
                <div class="option-group">
                    <div class="option-title">Font</div>
                    <div class="option-row">
                        <div class="font-option selected" data-font="Arial">Arial</div>
                        <div class="font-option" data-font="Times New Roman">Times</div>
                        <div class="font-option" data-font="Courier New">Courier</div>
                        <div class="font-option" data-font="Verdana">Verdana</div>
                    </div>
                </div>
                <div class="option-group">
                    <div class="option-title">Size</div>
                    <div class="option-row">
                        <div class="font-option" data-size="12">12</div>
                        <div class="font-option selected" data-size="16">16</div>
                        <div class="font-option" data-size="20">20</div>
                        <div class="font-option" data-size="24">24</div>
                    </div>
                </div>
                <div class="option-group">
                    <div class="option-title">Color</div>
                    <div class="option-row">
                        <div class="color-option selected" style="background-color: #000000;" data-color="#000000"></div>
                        <div class="color-option" style="background-color: #ff0000;" data-color="#ff0000"></div>
                        <div class="color-option" style="background-color: #00ff00;" data-color="#00ff00"></div>
                        <div class="color-option" style="background-color: #0000ff;" data-color="#0000ff"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Collaboration</div>
                <div class="sidebar-close" id="sidebar-close">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="sidebar-content">
                <!-- Video Section -->
                <div class="video-container">
                    <h3>Video Conference</h3>
                    <div class="video-grid">
                        <div class="video-item">
                            <video id="local-video" autoplay muted></video>
                        </div>
                        <div class="video-item">
                            <video id="remote-video" autoplay></video>
                        </div>
                    </div>
                    <div class="video-controls">
                        <div class="video-control-btn" id="video-toggle">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="video-control-btn" id="audio-toggle">
                            <i class="fas fa-microphone"></i>
                        </div>
                        <div class="video-control-btn" id="screen-share">
                            <i class="fas fa-desktop"></i>
                        </div>
                        <div class="video-control-btn" id="end-call">
                            <i class="fas fa-phone-slash"></i>
                        </div>
                    </div>
                </div>

                <!-- Chat Section -->
                <div class="chat-container">
                    <h3>Chat</h3>
                    <div class="chat-messages" id="chat-messages">
                        <div class="message">
                            <div class="message-avatar">JD</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <div class="message-sender">John Doe</div>
                                    <div class="message-time">10:30 AM</div>
                                </div>
                                <div class="message-text">
                                    Hello everyone! Ready for today's lesson?
                                </div>
                            </div>
                        </div>
                        <div class="message me">
                            <div class="message-avatar">ME</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <div class="message-sender">You</div>
                                    <div class="message-time">10:31 AM</div>
                                </div>
                                <div class="message-text">
                                    Yes, I'm ready!
                                </div>
                            </div>
                        </div>
                        <div class="message">
                            <div class="message-avatar">AS</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <div class="message-sender">Alice Smith</div>
                                    <div class="message-time">10:32 AM</div>
                                </div>
                                <div class="message-text">
                                    I have a question about the previous lesson. Can we go over it quickly?
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chat-input" placeholder="Type your message...">
                        <button id="send-message"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Whiteboard Canvas Setup
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas to full size of container
            function resizeCanvas() {
                const container = document.querySelector('.whiteboard');
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                
                // Redraw everything when resized
                redrawCanvas();
            }
            
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            
            // Drawing state
            let isDrawing = false;
            let currentTool = 'pen';
            let currentColor = '#000000';
            let currentSize = 2;
            let currentFont = 'Arial';
            let currentFontSize = 16;
            let lastX = 0;
            let lastY = 0;
            let drawings = [];
            let textElements = [];
            let shapes = [];
            let selectedElement = null;
            
            // Tool buttons
            const toolButtons = document.querySelectorAll('.tool-btn');
            
            toolButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    toolButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Set current tool
                    currentTool = this.getAttribute('data-tool');
                    
                    // Hide all tool options
                    document.querySelectorAll('.tool-options').forEach(option => {
                        option.classList.remove('active');
                    });
                    
                    // Show options for current tool if available
                    if (currentTool === 'pen' || currentTool === 'highlighter') {
                        document.getElementById('pen-options').classList.add('active');
                    } else if (currentTool === 'text') {
                        document.getElementById('text-options').classList.add('active');
                    }
                    
                    // Change cursor based on tool
                    switch(currentTool) {
                        case 'pen':
                        case 'highlighter':
                        case 'eraser':
                            canvas.style.cursor = 'crosshair';
                            break;
                        case 'select':
                            canvas.style.cursor = 'default';
                            break;
                        case 'text':
                            canvas.style.cursor = 'text';
                            break;
                        default:
                            canvas.style.cursor = 'crosshair';
                    }
                });
            });
            
            // Color options
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.color-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    currentColor = this.getAttribute('data-color');
                });
            });
            
            // Size options
            document.querySelectorAll('.size-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.size-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    currentSize = parseInt(this.getAttribute('data-size'));
                });
            });
            
            // Font options
            document.querySelectorAll('.font-option').forEach(option => {
                option.addEventListener('click', function() {
                    const group = this.parentElement;
                    group.querySelectorAll('.font-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    
                    if (this.hasAttribute('data-font')) {
                        currentFont = this.getAttribute('data-font');
                    } else if (this.hasAttribute('data-size')) {
                        currentFontSize = parseInt(this.getAttribute('data-size'));
                    }
                });
            });
            
            // Drawing functions
            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = getPosition(e);
                
                if (currentTool === 'text') {
                    const text = prompt('Enter your text:');
                    if (text) {
                        textElements.push({
                            x: lastX,
                            y: lastY,
                            text: text,
                            color: currentColor,
                            font: currentFont,
                            size: currentFontSize
                        });
                        redrawCanvas();
                    }
                    isDrawing = false;
                    return;
                }
                
                if (currentTool === 'select') {
                    // Check if clicked on an element
                    selectedElement = null;
                    
                    // Check text elements
                    for (let i = textElements.length - 1; i >= 0; i--) {
                        const text = textElements[i];
                        ctx.font = `${text.size}px ${text.font}`;
                        const metrics = ctx.measureText(text.text);
                        const textWidth = metrics.width;
                        const textHeight = text.size;
                        
                        if (lastX >= text.x && lastX <= text.x + textWidth &&
                            lastY >= text.y - textHeight && lastY <= text.y) {
                            selectedElement = { type: 'text', index: i };
                            break;
                        }
                    }
                    
                    // Check shapes
                    for (let i = shapes.length - 1; i >= 0; i--) {
                        const shape = shapes[i];
                        // Simple bounding box check for demo
                        if (lastX >= shape.x && lastX <= shape.x + shape.width &&
                            lastY >= shape.y && lastY <= shape.y + shape.height) {
                            selectedElement = { type: 'shape', index: i };
                            break;
                        }
                    }
                    
                    // Check drawings (more complex, would need to store drawing paths properly)
                    
                    if (selectedElement) {
                        console.log('Selected element:', selectedElement);
                    }
                    
                    return;
                }
                
                if (currentTool === 'rectangle' || currentTool === 'circle' || currentTool === 'line' || currentTool === 'arrow' || currentTool === 'triangle') {
                    return;
                }
                
                // For pen/highlighter/eraser
                drawings.push({
                    tool: currentTool,
                    color: currentTool === 'eraser' ? '#ffffff' : currentColor,
                    size: currentSize,
                    points: [{ x: lastX, y: lastY }]
                });
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                const [x, y] = getPosition(e);
                
                if (currentTool === 'rectangle' || currentTool === 'circle' || currentTool === 'line' || currentTool === 'arrow' || currentTool === 'triangle') {
                    // For shapes, we'll draw them on mouse up
                    return;
                }
                
                // For pen/highlighter/eraser
                const currentDrawing = drawings[drawings.length - 1];
                currentDrawing.points.push({ x, y });
                
                redrawCanvas();
                
                lastX = x;
                lastY = y;
            }
            
            function stopDrawing(e) {
                if (!isDrawing) return;
                
                const [x, y] = getPosition(e);
                
                if (currentTool === 'rectangle') {
                    shapes.push({
                        type: 'rectangle',
                        x: Math.min(lastX, x),
                        y: Math.min(lastY, y),
                        width: Math.abs(x - lastX),
                        height: Math.abs(y - lastY),
                        color: currentColor,
                        fill: false
                    });
                } else if (currentTool === 'circle') {
                    const radius = Math.sqrt(Math.pow(x - lastX, 2) + Math.pow(y - lastY, 2));
                    shapes.push({
                        type: 'circle',
                        x: lastX,
                        y: lastY,
                        radius: radius,
                        color: currentColor,
                        fill: false
                    });
                } else if (currentTool === 'line') {
                    shapes.push({
                        type: 'line',
                        x1: lastX,
                        y1: lastY,
                        x2: x,
                        y2: y,
                        color: currentColor,
                        size: currentSize
                    });
                } else if (currentTool === 'arrow') {
                    shapes.push({
                        type: 'arrow',
                        x1: lastX,
                        y1: lastY,
                        x2: x,
                        y2: y,
                        color: currentColor,
                        size: currentSize
                    });
                } else if (currentTool === 'triangle') {
                    shapes.push({
                        type: 'triangle',
                        x1: lastX,
                        y1: y,
                        x2: x,
                        y2: y,
                        x3: (lastX + x) / 2,
                        y3: lastY,
                        color: currentColor,
                        fill: false
                    });
                }
                
                isDrawing = false;
                redrawCanvas();
            }
            
            function getPosition(e) {
                const rect = canvas.getBoundingClientRect();
                return [
                    e.clientX - rect.left,
                    e.clientY - rect.top
                ];
            }
            
            function redrawCanvas() {
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Redraw all drawings
                drawings.forEach(drawing => {
                    ctx.beginPath();
                    ctx.moveTo(drawing.points[0].x, drawing.points[0].y);
                    
                    for (let i = 1; i < drawing.points.length; i++) {
                        ctx.lineTo(drawing.points[i].x, drawing.points[i].y);
                    }
                    
                    ctx.strokeStyle = drawing.color;
                    ctx.lineWidth = drawing.size;
                    ctx.lineJoin = 'round';
                    ctx.lineCap = 'round';
                    ctx.stroke();
                });
                
                // Redraw all shapes
                shapes.forEach(shape => {
                    ctx.strokeStyle = shape.color;
                    ctx.lineWidth = shape.size || 2;
                    
                    if (shape.type === 'rectangle') {
                        ctx.beginPath();
                        ctx.rect(shape.x, shape.y, shape.width, shape.height);
                        if (shape.fill) {
                            ctx.fillStyle = shape.color;
                            ctx.fill();
                        } else {
                            ctx.stroke();
                        }
                    } else if (shape.type === 'circle') {
                        ctx.beginPath();
                        ctx.arc(shape.x, shape.y, shape.radius, 0, Math.PI * 2);
                        if (shape.fill) {
                            ctx.fillStyle = shape.color;
                            ctx.fill();
                        } else {
                            ctx.stroke();
                        }
                    } else if (shape.type === 'line') {
                        ctx.beginPath();
                        ctx.moveTo(shape.x1, shape.y1);
                        ctx.lineTo(shape.x2, shape.y2);
                        ctx.stroke();
                    } else if (shape.type === 'arrow') {
                        // Draw line
                        ctx.beginPath();
                        ctx.moveTo(shape.x1, shape.y1);
                        ctx.lineTo(shape.x2, shape.y2);
                        ctx.stroke();
                        
                        // Draw arrowhead
                        const headLength = 15;
                        const angle = Math.atan2(shape.y2 - shape.y1, shape.x2 - shape.x1);
                        
                        ctx.beginPath();
                        ctx.moveTo(shape.x2, shape.y2);
                        ctx.lineTo(
                            shape.x2 - headLength * Math.cos(angle - Math.PI / 6),
                            shape.y2 - headLength * Math.sin(angle - Math.PI / 6)
                        );
                        ctx.moveTo(shape.x2, shape.y2);
                        ctx.lineTo(
                            shape.x2 - headLength * Math.cos(angle + Math.PI / 6),
                            shape.y2 - headLength * Math.sin(angle + Math.PI / 6)
                        );
                        ctx.stroke();
                    } else if (shape.type === 'triangle') {
                        ctx.beginPath();
                        ctx.moveTo(shape.x1, shape.y1);
                        ctx.lineTo(shape.x2, shape.y2);
                        ctx.lineTo(shape.x3, shape.y3);
                        ctx.closePath();
                        if (shape.fill) {
                            ctx.fillStyle = shape.color;
                            ctx.fill();
                        } else {
                            ctx.stroke();
                        }
                    }
                });
                
                // Redraw all text elements
                textElements.forEach(text => {
                    ctx.font = `${text.size}px ${text.font}`;
                    ctx.fillStyle = text.color;
                    ctx.fillText(text.text, text.x, text.y);
                });
                
                // Draw selection if needed
                if (selectedElement) {
                    const element = selectedElement.type === 'text' ? textElements[selectedElement.index] : shapes[selectedElement.index];
                    
                    ctx.strokeStyle = '#4a6bff';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                    
                    if (selectedElement.type === 'text') {
                        const metrics = ctx.measureText(element.text);
                        const textWidth = metrics.width;
                        const textHeight = element.size;
                        
                        ctx.strokeRect(
                            element.x - 5,
                            element.y - textHeight - 5,
                            textWidth + 10,
                            textHeight + 10
                        );
                    } else if (element.type === 'rectangle') {
                        ctx.strokeRect(
                            element.x - 5,
                            element.y - 5,
                            element.width + 10,
                            element.height + 10
                        );
                    } else if (element.type === 'circle') {
                        ctx.beginPath();
                        ctx.arc(
                            element.x,
                            element.y,
                            element.radius + 5,
                            0,
                            Math.PI * 2
                        );
                        ctx.stroke();
                    }
                    
                    ctx.setLineDash([]);
                }
            }
            
            // Event listeners for drawing
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Sidebar toggle
            const sidebar = document.getElementById('sidebar');
            const sidebarClose = document.getElementById('sidebar-close');
            
            sidebarClose.addEventListener('click', function() {
                sidebar.classList.toggle('open');
            });
            
            // Video chat simulation
            const videoToggle = document.getElementById('video-toggle');
            const audioToggle = document.getElementById('audio-toggle');
            const screenShare = document.getElementById('screen-share');
            const endCall = document.getElementById('end-call');
            const localVideo = document.getElementById('local-video');
            const remoteVideo = document.getElementById('remote-video');
            
            let videoEnabled = true;
            let audioEnabled = true;
            let screenSharing = false;
            
            // Simulate video stream (in a real app, this would use getUserMedia)
            localVideo.srcObject = new MediaStream();
            remoteVideo.srcObject = new MediaStream();
            
            videoToggle.addEventListener('click', function() {
                videoEnabled = !videoEnabled;
                this.innerHTML = videoEnabled ? '<i class="fas fa-video"></i>' : '<i class="fas fa-video-slash"></i>';
                this.style.backgroundColor = videoEnabled ? 'var(--gray-light)' : 'var(--danger-color)';
                this.style.color = videoEnabled ? 'inherit' : 'white';
            });
            
            audioToggle.addEventListener('click', function() {
                audioEnabled = !audioEnabled;
                this.innerHTML = audioEnabled ? '<i class="fas fa-microphone"></i>' : '<i class="fas fa-microphone-slash"></i>';
                this.style.backgroundColor = audioEnabled ? 'var(--gray-light)' : 'var(--danger-color)';
                this.style.color = audioEnabled ? 'inherit' : 'white';
            });
            
            screenShare.addEventListener('click', function() {
                screenSharing = !screenSharing;
                this.style.backgroundColor = screenSharing ? 'var(--primary-color)' : 'var(--gray-light)';
                this.style.color = screenSharing ? 'white' : 'inherit';
            });
            
            endCall.addEventListener('click', function() {
                // In a real app, this would end the call
                alert('Call ended');
            });
            
            // Chat functionality
            const chatInput = document.getElementById('chat-input');
            const sendMessage = document.getElementById('send-message');
            const chatMessages = document.getElementById('chat-messages');
            
            function addMessage(sender, text, isMe = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isMe ? 'me' : ''}`;
                
                const now = new Date();
                const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                messageDiv.innerHTML = `
                    <div class="message-avatar">${sender.substring(0, 2).toUpperCase()}</div>
                    <div class="message-content">
                        <div class="message-header">
                            <div class="message-sender">${isMe ? 'You' : sender}</div>
                            <div class="message-time">${timeString}</div>
                        </div>
                        <div class="message-text">${text}</div>
                    </div>
                `;
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            sendMessage.addEventListener('click', function() {
                const message = chatInput.value.trim();
                if (message) {
                    addMessage('You', message, true);
                    chatInput.value = '';
                    
                    // Simulate response after 1-3 seconds
                    setTimeout(() => {
                        const responses = [
                            "Thanks for your message!",
                            "I'll get back to you on that.",
                            "Interesting point!",
                            "Let me think about that...",
                            "Can you elaborate?"
                        ];
                        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                        addMessage('Teacher', randomResponse);
                    }, 1000 + Math.random() * 2000);
                }
            });
            
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage.click();
                }
            });
        });
    </script>
</body>
</html>
