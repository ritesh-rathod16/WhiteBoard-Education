<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhiteBoard Education | Collaborative Whiteboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #f5f7ff;
            --dark-color: #1a1a2e;
            --light-color: #ffffff;
            --accent-color: #ff6b6b;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--secondary-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Logo Animation */
        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }

        /* Header Styles */
        header {
            background-color: var(--light-color);
            box-shadow: var(--shadow);
            padding: 0.8rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: fadeInScale 1s ease-out;
        }

        .logo {
            height: 40px;
            animation: pulse 2s infinite;
        }

        .app-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            letter-spacing: 1px;
        }

        .user-count {
            background-color: var(--primary-color);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        /* Main Container */
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Toolbar Styles */
        .toolbar {
            background-color: var(--light-color);
            width: 70px;
            padding: 1rem 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            box-shadow: var(--shadow);
            z-index: 90;
            overflow-y: auto;
        }

        .tool-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            width: 100%;
        }

        .tool {
            width: 42px;
            height: 42px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .tool:hover {
            background-color: var(--secondary-color);
        }

        .tool.active {
            background-color: var(--primary-color);
            color: white;
        }

        .tool i {
            font-size: 1.2rem;
        }

        .tool-label {
            position: absolute;
            left: 50px;
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--dark-color);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: var(--transition);
            z-index: 100;
        }

        .tool:hover .tool-label {
            opacity: 1;
            left: 55px;
        }

        .divider {
            width: 80%;
            height: 1px;
            background-color: var(--border-color);
            margin: 0.5rem 0;
        }

        /* Color Picker */
        .color-picker {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            width: 100%;
        }

        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            border-color: var(--dark-color);
            transform: scale(1.1);
        }

        .brush-size {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .size-option {
            width: 60%;
            height: 4px;
            background-color: var(--text-color);
            border-radius: 2px;
            cursor: pointer;
            transition: var(--transition);
        }

        .size-option:hover {
            background-color: var(--primary-color);
        }

        .size-option.active {
            background-color: var(--primary-color);
            height: 6px;
        }

        /* Whiteboard Area */
        .whiteboard-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .whiteboard-header {
            padding: 0.8rem 1rem;
            background-color: var(--light-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            z-index: 10;
        }

        .slide-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .slide-btn {
            background-color: var(--secondary-color);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .slide-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .slide-counter {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .whiteboard-actions {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .action-btn {
            background-color: var(--secondary-color);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .action-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .whiteboard-area {
            flex: 1;
            background-color: white;
            overflow: hidden;
            position: relative;
        }

        canvas {
            background-color: white;
            cursor: crosshair;
            touch-action: none;
        }

        .remote-cursor {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 50;
        }

        .cursor-label {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 0.7rem;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            white-space: nowrap;
            pointer-events: none;
        }

        /* Right Panel */
        .right-panel {
            width: 350px;
            background-color: var(--light-color);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            z-index: 80;
            transition: var(--transition);
        }

        .panel-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
        }

        .panel-tab {
            flex: 1;
            padding: 0.8rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .panel-tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        /* Participants List */
        .participants-list {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .participant {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.5rem;
            border-radius: 6px;
            transition: var(--transition);
        }

        .participant:hover {
            background-color: var(--secondary-color);
        }

        .participant-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 600;
        }

        .participant-info {
            flex: 1;
        }

        .participant-name {
            font-weight: 500;
            font-size: 0.95rem;
        }

        .participant-role {
            font-size: 0.7rem;
            color: #666;
        }

        .participant-actions {
            display: flex;
            gap: 0.5rem;
        }

        .participant-action {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .participant-action:hover {
            background-color: #e0e0e0;
        }

        /* Video Chat */
        .video-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .main-video {
            width: 100%;
            aspect-ratio: 16/9;
            background-color: var(--dark-color);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .video-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            gap: 0.5rem;
        }

        .video-placeholder i {
            font-size: 2rem;
        }

        .video-placeholder p {
            font-size: 0.9rem;
        }

        .video-thumbnails {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
        }

        .video-thumbnail {
            aspect-ratio: 16/9;
            background-color: var(--dark-color);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .video-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            padding: 1rem 0;
        }

        .video-control {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .video-control:hover {
            background-color: #e0e0e0;
        }

        .video-control.active {
            background-color: var(--primary-color);
            color: white;
        }

        .video-control.end-call {
            background-color: var(--accent-color);
            color: white;
        }

        /* Slides Thumbnails */
        .slides-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .slides-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.8rem;
        }

        .slide-thumbnail {
            aspect-ratio: 16/9;
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .slide-thumbnail.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-color);
        }

        .slide-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .slide-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.3rem;
            opacity: 0;
            transition: var(--transition);
        }

        .slide-thumbnail:hover .slide-actions {
            opacity: 1;
        }

        .slide-action {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .slide-action:hover {
            background-color: white;
        }

        .add-slide {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--secondary-color);
            color: var(--primary-color);
            cursor: pointer;
        }

        .add-slide:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Bottom Controls */
        .bottom-controls {
            background-color: var(--light-color);
            padding: 0.8rem 1.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
            z-index: 90;
        }

        .control-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-color);
            position: relative;
        }

        .control-btn:hover {
            color: var(--primary-color);
        }

        .control-btn i {
            font-size: 1.2rem;
        }

        .control-btn .label {
            font-size: 0.7rem;
        }

        .control-btn.active {
            color: var(--primary-color);
        }

        .more-options {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--light-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 0.8rem;
            display: none;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 100;
            width: 200px;
        }

        .more-options.show {
            display: flex;
        }

        .option-item {
            padding: 0.5rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            transition: var(--transition);
        }

        .option-item:hover {
            background-color: var(--secondary-color);
        }

        .option-item i {
            width: 20px;
            text-align: center;
        }

        /* Reaction Picker */
        .reaction-picker {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--light-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 0.8rem;
            display: none;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            z-index: 100;
        }

        .reaction-picker.show {
            display: grid;
        }

        .reaction-option {
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            padding: 0.3rem;
            border-radius: 4px;
        }

        .reaction-option:hover {
            transform: scale(1.2);
            background-color: var(--secondary-color);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal {
            background-color: var(--light-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: var(--transition);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1.2rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--accent-color);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background-color: #3a5ae8;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: none;
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        .btn-danger {
            background-color: var(--accent-color);
            color: white;
            border: none;
        }

        .btn-danger:hover {
            background-color: #e05555;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 107, 255, 0.2);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.8rem;
        }

        .checkbox-label {
            cursor: pointer;
        }

        /* Settings Sections */
        .settings-section {
            margin-bottom: 1.5rem;
        }

        .settings-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .right-panel {
                width: 300px;
            }
        }

        @media (max-width: 992px) {
            .right-panel {
                position: absolute;
                right: -350px;
                top: 0;
                bottom: 0;
                box-shadow: none;
            }

            .right-panel.active {
                right: 0;
                box-shadow: var(--shadow);
            }

            .toggle-panel {
                display: flex !important;
            }
        }

        @media (max-width: 768px) {
            .toolbar {
                width: 60px;
                padding: 0.8rem 0.3rem;
            }

            .tool {
                width: 36px;
                height: 36px;
            }

            .bottom-controls {
                gap: 1rem;
                padding: 0.8rem 1rem;
            }

            .control-btn .label {
                display: none;
            }
        }

        @media (max-width: 576px) {
            .app-name {
                display: none;
            }

            .whiteboard-actions .action-btn span {
                display: none;
            }

            .whiteboard-actions .action-btn i {
                margin-right: 0;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .toggle-panel {
            display: none;
            position: fixed;
            right: 20px;
            bottom: 80px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            z-index: 95;
        }

        .toggle-panel i {
            font-size: 1.2rem;
        }

        /* Loading Animation */
        .loading-animation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--light-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            z-index: 2000;
        }

        .loading-logo {
            height: 80px;
            animation: pulse 2s infinite;
        }

        .loading-text {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--secondary-color);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Virtual Background Selector */
        .background-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .background-option {
            aspect-ratio: 16/9;
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .background-option:hover {
            transform: scale(1.03);
        }

        .background-option.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(74, 107, 255, 0.5);
        }

        .background-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .background-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.5rem;
            text-align: center;
            font-size: 0.8rem;
        }

        /* Exit Screen */
        .exit-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            color: white;
            text-align: center;
            padding: 2rem;
        }

        .exit-image {
            max-width: 100%;
            max-height: 60vh;
            margin-bottom: 2rem;
            border-radius: 8px;
        }

        .exit-message {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            max-width: 600px;
        }

        .exit-buttons {
            display: flex;
            gap: 1rem;
        }
    </style>
</head>
<body>
    <!-- Loading Animation -->
    <div class="loading-animation">
        <img src="https://sigmawire.net/i/04/itNgcI.png" alt="WhiteBoard Education Logo" class="loading-logo">
        <div class="loading-text">WhiteBoard Education</div>
        <div class="spinner"></div>
    </div>

    <!-- Header -->
    <header>
        <div class="logo-container">
            <img src="https://sigmawire.net/i/04/itNgcI.png" alt="WhiteBoard Education Logo" class="logo">
            <span class="app-name">WhiteBoard Education</span>
        </div>
        <div class="user-count">
            <i class="fas fa-users"></i>
            <span id="userCount">1</span>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Toolbar -->
        <div class="toolbar">
            <div class="tool-group">
                <div class="tool active" data-tool="pencil" title="Pencil">
                    <i class="fas fa-pencil-alt"></i>
                    <span class="tool-label">Pencil</span>
                </div>
                <div class="tool" data-tool="line" title="Line">
                    <i class="fas fa-slash"></i>
                    <span class="tool-label">Line</span>
                </div>
                <div class="tool" data-tool="rectangle" title="Rectangle">
                    <i class="far fa-square"></i>
                    <span class="tool-label">Rectangle</span>
                </div>
                <div class="tool" data-tool="circle" title="Circle">
                    <i class="far fa-circle"></i>
                    <span class="tool-label">Circle</span>
                </div>
                <div class="tool" data-tool="text" title="Text">
                    <i class="fas fa-font"></i>
                    <span class="tool-label">Text</span>
                </div>
                <div class="tool" data-tool="eraser" title="Eraser">
                    <i class="fas fa-eraser"></i>
                    <span class="tool-label">Eraser</span>
                </div>
            </div>

            <div class="divider"></div>

            <div class="color-picker">
                <div class="color-option active" style="background-color: #000000;" data-color="#000000"></div>
                <div class="color-option" style="background-color: #ff0000;" data-color="#ff0000"></div>
                <div class="color-option" style="background-color: #00ff00;" data-color="#00ff00"></div>
                <div class="color-option" style="background-color: #0000ff;" data-color="#0000ff"></div>
                <div class="color-option" style="background-color: #ffff00;" data-color="#ffff00"></div>
                <div class="color-option" style="background-color: #ff00ff;" data-color="#ff00ff"></div>
                <div class="color-option" style="background-color: #00ffff;" data-color="#00ffff"></div>
                <div class="color-option" style="background-color: #ffffff; border: 1px solid #ccc;" data-color="#ffffff"></div>
            </div>

            <div class="divider"></div>

            <div class="brush-size">
                <div class="size-option active" data-size="2"></div>
                <div class="size-option" data-size="5"></div>
                <div class="size-option" data-size="10"></div>
                <div class="size-option" data-size="15"></div>
            </div>

            <div class="divider"></div>

            <div class="tool-group">
                <div class="tool" data-tool="clear" title="Clear Board">
                    <i class="fas fa-trash"></i>
                    <span class="tool-label">Clear Board</span>
                </div>
                <div class="tool" data-tool="undo" title="Undo">
                    <i class="fas fa-undo"></i>
                    <span class="tool-label">Undo</span>
                </div>
                <div class="tool" data-tool="redo" title="Redo">
                    <i class="fas fa-redo"></i>
                    <span class="tool-label">Redo</span>
                </div>
                <div class="tool" data-tool="save" title="Save">
                    <i class="fas fa-save"></i>
                    <span class="tool-label">Save</span>
                </div>
                <div class="tool" data-tool="load" title="Load">
                    <i class="fas fa-folder-open"></i>
                    <span class="tool-label">Load</span>
                </div>
            </div>
        </div>

        <!-- Whiteboard Area -->
        <div class="whiteboard-container">
            <div class="whiteboard-header">
                <div class="slide-controls">
                    <button class="slide-btn" id="prevSlide">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="slide-counter">Slide 1 of 1</span>
                    <button class="slide-btn" id="nextSlide">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <button class="slide-btn" id="addSlide">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="slide-btn" id="duplicateSlide">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
                <div class="whiteboard-actions">
                    <button class="action-btn" id="recordBtn">
                        <i class="fas fa-circle"></i>
                        <span>Record</span>
                    </button>
                    <button class="action-btn" id="exportBtn">
                        <i class="fas fa-file-export"></i>
                        <span>Export</span>
                    </button>
                </div>
            </div>
            <div class="whiteboard-area">
                <canvas id="whiteboard"></canvas>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel" id="rightPanel">
            <div class="panel-tabs">
                <div class="panel-tab active" data-tab="participants">Participants</div>
                <div class="panel-tab" data-tab="video">Video</div>
                <div class="panel-tab" data-tab="slides">Slides</div>
            </div>
            <div class="panel-content">
                <!-- Participants Tab -->
                <div class="panel-tab-content active" data-tab-content="participants">
                    <div class="participants-list" id="participantsList">
                        <!-- Participants will be added here dynamically -->
                    </div>
                </div>

                <!-- Video Tab -->
                <div class="panel-tab-content" data-tab-content="video">
                    <div class="video-container">
                        <div class="main-video">
                            <div class="video-placeholder">
                                <i class="fas fa-user"></i>
                                <p>Your video will appear here</p>
                            </div>
                            <video id="localVideo" autoplay muted playsinline style="display: none; width: 100%; height: 100%;"></video>
                            <video id="remoteVideo" autoplay playsinline style="display: none; width: 100%; height: 100%;"></video>
                        </div>
                        <div class="video-thumbnails" id="videoThumbnails">
                            <!-- Video thumbnails will be added here dynamically -->
                        </div>
                        <div class="video-controls">
                            <div class="video-control" id="toggleMic">
                                <i class="fas fa-microphone"></i>
                            </div>
                            <div class="video-control" id="toggleVideo">
                                <i class="fas fa-video"></i>
                            </div>
                            <div class="video-control" id="toggleBackground">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="video-control end-call" id="endCall">
                                <i class="fas fa-phone-slash"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Slides Tab -->
                <div class="panel-tab-content" data-tab-content="slides">
                    <div class="slides-container">
                        <div class="slides-list" id="slidesList">
                            <div class="slide-thumbnail active">
                                <img src="" alt="Slide 1">
                                <div class="slide-actions">
                                    <div class="slide-action" title="Delete Slide">
                                        <i class="fas fa-trash"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="slide-thumbnail add-slide" id="addSlideThumbnail">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toggle Panel Button (Mobile) -->
        <div class="toggle-panel" id="togglePanel">
            <i class="fas fa-users"></i>
        </div>
    </div>

    <!-- Bottom Controls -->
    <div class="bottom-controls">
        <div class="control-btn" id="micControl">
            <i class="fas fa-microphone"></i>
            <span class="label">Mic</span>
        </div>
        <div class="control-btn" id="videoControl">
            <i class="fas fa-video"></i>
            <span class="label">Video</span>
        </div>
        <div class="control-btn" id="screenShareControl">
            <i class="fas fa-desktop"></i>
            <span class="label">Share</span>
        </div>
        <div class="control-btn" id="participantsControl">
            <i class="fas fa-users"></i>
            <span class="label">Participants</span>
        </div>
        <div class="control-btn" id="raiseHandControl">
            <i class="fas fa-hand-paper"></i>
            <span class="label">Raise Hand</span>
        </div>
        <div class="control-btn" id="reactionsControl">
            <i class="far fa-smile"></i>
            <span class="label">Reactions</span>
            <div class="reaction-picker" id="reactionPicker">
                <div class="reaction-option">üëç</div>
                <div class="reaction-option">üëé</div>
                <div class="reaction-option">üëè</div>
                <div class="reaction-option">üôå</div>
                <div class="reaction-option">üòÇ</div>
                <div class="reaction-option">üòÆ</div>
                <div class="reaction-option">üò¢</div>
                <div class="reaction-option">‚ù§Ô∏è</div>
            </div>
        </div>
        <div class="control-btn" id="moreControl">
            <i class="fas fa-ellipsis-h"></i>
            <span class="label">More</span>
            <div class="more-options" id="moreOptions">
                <div class="option-item" id="chatOption">
                    <i class="far fa-comment-dots"></i>
                    <span>Chat</span>
                </div>
                <div class="option-item" id="inviteOption">
                    <i class="fas fa-user-plus"></i>
                    <span>Invite</span>
                </div>
                <div class="option-item" id="settingsOption">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
                <div class="option-item" id="leaveOption">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Leave</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Save Modal -->
    <div class="modal-overlay" id="saveModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Save Whiteboard</div>
                <button class="modal-close" id="closeSaveModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="fileName">File Name</label>
                    <input type="text" class="form-control" id="fileName" placeholder="Enter file name">
                </div>
                <div class="form-group">
                    <label class="form-label">Format</label>
                    <div class="checkbox-group">
                        <input type="radio" id="formatPng" name="format" value="png" checked>
                        <label class="checkbox-label" for="formatPng">PNG</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" id="formatJpg" name="format" value="jpg">
                        <label class="checkbox-label" for="formatJpg">JPG</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" id="formatPdf" name="format" value="pdf">
                        <label class="checkbox-label" for="formatPdf">PDF</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSave">Cancel</button>
                <button class="btn btn-primary" id="confirmSave">Save</button>
            </div>
        </div>
    </div>

    <!-- Load Modal -->
    <div class="modal-overlay" id="loadModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Load Whiteboard</div>
                <button class="modal-close" id="closeLoadModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Select File</label>
                    <input type="file" class="form-control" id="fileInput" accept=".png,.jpg,.jpeg,.pdf,.wb">
                </div>
                <div id="savedFilesList">
                    <!-- Saved files will be listed here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelLoad">Cancel</button>
                <button class="btn btn-primary" id="confirmLoad">Load</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Export Whiteboard</div>
                <button class="modal-close" id="closeExportModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="exportFileName">File Name</label>
                    <input type="text" class="form-control" id="exportFileName" placeholder="Enter file name">
                </div>
                <div class="form-group">
                    <label class="form-label">Export Options</label>
                    <div class="checkbox-group">
                        <input type="radio" id="exportCurrent" name="exportOption" value="current" checked>
                        <label class="checkbox-label" for="exportCurrent">Current Slide Only</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" id="exportAll" name="exportOption" value="all">
                        <label class="checkbox-label" for="exportAll">All Slides</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Format</label>
                    <div class="checkbox-group">
                        <input type="radio" id="exportPng" name="exportFormat" value="png" checked>
                        <label class="checkbox-label" for="exportPng">PNG</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" id="exportJpg" name="exportFormat" value="jpg">
                        <label class="checkbox-label" for="exportJpg">JPG</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" id="exportPdf" name="exportFormat" value="pdf">
                        <label class="checkbox-label" for="exportPdf">PDF</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelExport">Cancel</button>
                <button class="btn btn-primary" id="confirmExport">Export</button>
            </div>
        </div>
    </div>

    <!-- Invite Modal -->
    <div class="modal-overlay" id="inviteModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Invite Participants</div>
                <button class="modal-close" id="closeInviteModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Meeting Link</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" class="form-control" id="meetingLink" readonly>
                        <button class="btn btn-primary" id="copyLink">Copy</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Meeting ID</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" class="form-control" id="meetingId" readonly>
                        <button class="btn btn-primary" id="copyId">Copy</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Invite via Email</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="email" class="form-control" id="inviteEmail" placeholder="Enter email address">
                        <button class="btn btn-primary" id="sendInvite">Send</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelInvite">Close</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">Settings</div>
                <button class="modal-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <div class="settings-title">üîí Security & Privacy Settings</div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="enableWaitingRoom" checked>
                        <label class="checkbox-label" for="enableWaitingRoom">Enable waiting room</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="requirePasscode">
                        <label class="checkbox-label" for="requirePasscode">Require meeting passcode</label>
                    </div>
                    <div class="form-group" id="passcodeGroup" style="display: none;">
                        <label class="form-label" for="meetingPasscode">Passcode</label>
                        <input type="text" class="form-control" id="meetingPasscode" placeholder="Enter passcode">
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="blockBeforeHost">
                        <label class="checkbox-label" for="blockBeforeHost">Block participants from joining before host</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowScreenShare" checked>
                        <label class="checkbox-label" for="allowScreenShare">Allow participant screen sharing</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="muteOnEntry">
                        <label class="checkbox-label" for="muteOnEntry">Mute participants on entry</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowRejoin" checked>
                        <label class="checkbox-label" for="allowRejoin">Allow removed participants to rejoin</label>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-title">üé• Video Settings</div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="hdVideo">
                        <label class="checkbox-label" for="hdVideo">HD video</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="touchUpAppearance">
                        <label class="checkbox-label" for="touchUpAppearance">Touch up my appearance</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="mirrorVideo">
                        <label class="checkbox-label" for="mirrorVideo">Mirror my video</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showPreview" checked>
                        <label class="checkbox-label" for="showPreview">Always show video preview</label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Virtual Background</label>
                        <div class="background-options">
                            <div class="background-option active" data-background="none">
                                <div style="width: 100%; height: 100%; background-color: #f0f0f0;"></div>
                                <div class="background-label">None</div>
                            </div>
                            <div class="background-option" data-background="blur">
                                <img src="https://via.placeholder.com/300x169?text=Blur" alt="Blur">
                                <div class="background-label">Blur</div>
                            </div>
                            <div class="background-option" data-background="office">
                                <img src="https://via.placeholder.com/300x169?text=Office" alt="Office">
                                <div class="background-label">Office</div>
                            </div>
                            <div class="background-option" data-background="meeting-room">
                                <img src="https://via.placeholder.com/300x169?text=Meeting+Room" alt="Meeting Room">
                                <div class="background-label">Meeting Room</div>
                            </div>
                            <div class="background-option" data-background="bedroom">
                                <img src="https://via.placeholder.com/300x169?text=Bedroom" alt="Bedroom">
                                <div class="background-label">Bedroom</div>
                            </div>
                            <div class="background-option" data-background="custom">
                                <i class="fas fa-plus" style="font-size: 2rem; color: #666; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"></i>
                                <div class="background-label">Add Custom</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-title">üéôÔ∏è Audio Settings</div>
                    <div class="form-group">
                        <label class="form-label" for="microphone">Microphone</label>
                        <select class="form-control" id="microphone">
                            <option>Default Microphone</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="speaker">Speaker</label>
                        <select class="form-control" id="speaker">
                            <option>Default Speaker</option>
                        </select>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="suppressNoise" checked>
                        <label class="checkbox-label" for="suppressNoise">Suppress background noise</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="originalSound">
                        <label class="checkbox-label" for="originalSound">Original sound for musicians</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="autoJoinAudio" checked>
                        <label class="checkbox-label" for="autoJoinAudio">Automatically join audio by computer</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSettings">Cancel</button>
                <button class="btn btn-primary" id="saveSettings">Save</button>
            </div>
        </div>
    </div>

    <!-- Leave Modal -->
    <div class="modal-overlay" id="leaveModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Leave Meeting</div>
                <button class="modal-close" id="closeLeaveModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to leave the meeting?</p>
                <div class="checkbox-group">
                    <input type="checkbox" id="saveBeforeLeave">
                    <label class="checkbox-label" for="saveBeforeLeave">Save whiteboard before leaving</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelLeave">Cancel</button>
                <button class="btn btn-danger" id="confirmLeave">Leave</button>
            </div>
        </div>
    </div>

    <!-- Exit Screen -->
    <div class="exit-screen" id="exitScreen" style="display: none;">
        <img src="https://cdn.corenexis.com/view/?img=d/ap16/vrIG9Z.jpg" alt="Meeting Ended" class="exit-image">
        <div class="exit-message">You have left the meeting. Thank you for using WhiteBoard Education!</div>
        <div class="exit-buttons">
            <button class="btn btn-primary" id="rejoinMeeting">Rejoin</button>
            <button class="btn btn-secondary" id="returnHome">Return to Home</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Simulate loading animation
            setTimeout(function() {
                document.querySelector('.loading-animation').style.display = 'none';
            }, 2000);

            // Initialize variables
            let canvas, currentTool = 'pencil', currentColor = '#000000', currentSize = 2;
            let isDrawing = false, lastX = 0, lastY = 0;
            let slides = [], currentSlideIndex = 0;
            let users = [];
            let localStream, peerConnections = {};
            let socket;
            let meetingId = generateMeetingId();
            let userId = generateUserId();
            let userName = `User${Math.floor(Math.random() * 1000)}`;
            let isHost = true; // First user is host by default
            let recording = false;
            let mediaRecorder;
            let recordedChunks = [];

            // Initialize the whiteboard
            function initWhiteboard() {
                canvas = new fabric.Canvas('whiteboard', {
                    isDrawingMode: true,
                    width: document.querySelector('.whiteboard-area').offsetWidth,
                    height: document.querySelector('.whiteboard-area').offsetHeight,
                    backgroundColor: '#ffffff'
                });

                // Add first slide
                addNewSlide();
            }

            // Generate a random meeting ID
            function generateMeetingId() {
                return Math.random().toString(36).substring(2, 8).toUpperCase();
            }

            // Generate a random user ID
            function generateUserId() {
                return 'user-' + Math.random().toString(36).substring(2, 9);
            }

            // Add a new slide
            function addNewSlide() {
                const newSlide = {
                    id: 'slide-' + Date.now(),
                    objects: [],
                    background: '#ffffff'
                };
                
                slides.push(newSlide);
                currentSlideIndex = slides.length - 1;
                updateSlideCounter();
                renderSlideThumbnails();
                
                // Clear canvas and set background
                canvas.clear();
                canvas.backgroundColor = newSlide.background;
                canvas.renderAll();
            }

            // Update slide counter
            function updateSlideCounter() {
                document.querySelector('.slide-counter').textContent = `Slide ${currentSlideIndex + 1} of ${slides.length}`;
            }

            // Render slide thumbnails
            function renderSlideThumbnails() {
                const slidesList = document.getElementById('slidesList');
                slidesList.innerHTML = '';
                
                slides.forEach((slide, index) => {
                    const slideElement = document.createElement('div');
                    slideElement.className = `slide-thumbnail ${index === currentSlideIndex ? 'active' : ''}`;
                    slideElement.innerHTML = `
                        <img src="" alt="Slide ${index + 1}">
                        <div class="slide-actions">
                            <div class="slide-action" title="Delete Slide">
                                <i class="fas fa-trash"></i>
                            </div>
                        </div>
                    `;
                    
                    // Set thumbnail image
                    setTimeout(() => {
                        const img = slideElement.querySelector('img');
                        img.src = canvas.toDataURL({
                            format: 'png',
                            quality: 0.1
                        });
                    }, 100);
                    
                    // Add click event
                    slideElement.addEventListener('click', () => {
                        if (index === currentSlideIndex) return;
                        
                        // Save current slide state
                        saveCurrentSlide();
                        
                        // Load new slide
                        currentSlideIndex = index;
                        loadSlide(currentSlideIndex);
                        updateSlideCounter();
                        
                        // Update active class
                        document.querySelectorAll('.slide-thumbnail').forEach(el => el.classList.remove('active'));
                        slideElement.classList.add('active');
                    });
                    
                    // Add delete event
                    const deleteBtn = slideElement.querySelector('.slide-action');
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (slides.length <= 1) {
                            alert('You cannot delete the only slide.');
                            return;
                        }
                        
                        slides.splice(index, 1);
                        if (currentSlideIndex >= index) {
                            currentSlideIndex = Math.max(0, currentSlideIndex - 1);
                        }
                        
                        loadSlide(currentSlideIndex);
                        renderSlideThumbnails();
                        updateSlideCounter();
                    });
                    
                    slidesList.appendChild(slideElement);
                });
                
                // Add "Add Slide" button
                const addSlideElement = document.createElement('div');
                addSlideElement.className = 'slide-thumbnail add-slide';
                addSlideElement.innerHTML = '<i class="fas fa-plus"></i>';
                addSlideElement.addEventListener('click', addNewSlide);
                slidesList.appendChild(addSlideElement);
            }

            // Save current slide state
            function saveCurrentSlide() {
                if (slides.length === 0 || currentSlideIndex < 0 || currentSlideIndex >= slides.length) return;
                
                const objects = canvas.toJSON().objects || [];
                slides[currentSlideIndex].objects = objects;
                slides[currentSlideIndex].background = canvas.backgroundColor;
            }

            // Load slide
            function loadSlide(index) {
                if (index < 0 || index >= slides.length) return;
                
                const slide = slides[index];
                canvas.clear();
                canvas.backgroundColor = slide.background;
                
                if (slide.objects && slide.objects.length > 0) {
                    canvas.loadFromJSON({ objects: slide.objects }, () => {
                        canvas.renderAll();
                    });
                } else {
                    canvas.renderAll();
                }
            }

            // Initialize Socket.io connection
            function initSocket() {
                // In a real app, you would connect to your server
                // socket = io('https://your-server.com');
                
                // For demo purposes, we'll simulate the connection
                console.log('Connecting to WebSocket server...');
                
                // Simulate connection
                setTimeout(() => {
                    console.log('Connected to WebSocket server');
                    
                    // Simulate receiving user list
                    updateUserList([
                        { id: userId, name: userName, role: isHost ? 'Host' : 'Participant', avatarColor: getRandomColor() }
                    ]);
                    
                    // Update UI
                    document.getElementById('userCount').textContent = '1';
                    
                    // Set up meeting link
                    document.getElementById('meetingLink').value = `${window.location.origin}?meeting=${meetingId}`;
                    document.getElementById('meetingId').value = meetingId;
                }, 1000);
            }

            // Update user list
            function updateUserList(userList) {
                users = userList;
                const participantsList = document.getElementById('participantsList');
                participantsList.innerHTML = '';
                
                userList.forEach(user => {
                    const participantElement = document.createElement('div');
                    participantElement.className = 'participant';
                    participantElement.innerHTML = `
                        <div class="participant-avatar" style="background-color: ${user.avatarColor}">
                            ${user.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="participant-info">
                            <div class="participant-name">${user.name} ${user.id === userId ? '(You)' : ''}</div>
                            <div class="participant-role">${user.role}</div>
                        </div>
                        <div class="participant-actions">
                            ${user.id !== userId ? `
                            <div class="participant-action" title="Pin Video">
                                <i class="fas fa-thumbtack"></i>
                            </div>
                            <div class="participant-action" title="Remove">
                                <i class="fas fa-times"></i>
                            </div>
                            ` : ''}
                        </div>
                    `;
                    
                    participantsList.appendChild(participantElement);
                });
            }

            // Get random color for avatar
            function getRandomColor() {
                const colors = ['#4a6bff', '#ff6b6b', '#6bff6b', '#ffb84a', '#b84aff', '#4affb8'];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            // Initialize WebRTC
            async function initWebRTC() {
                try {
                    localStream = await navigator.mediaDevices.getUserMedia({ 
                        video: true, 
                        audio: true 
                    });
                    
                    const localVideo = document.getElementById('localVideo');
                    localVideo.srcObject = localStream;
                    localVideo.style.display = 'block';
                    
                    // Add local video to thumbnails
                    addVideoThumbnail(userId, localStream, true);
                } catch (err) {
                    console.error('Error accessing media devices:', err);
                }
            }

            // Add video thumbnail
            function addVideoThumbnail(userId, stream, isLocal = false) {
                const videoThumbnails = document.getElementById('videoThumbnails');
                
                // Check if thumbnail already exists
                const existingThumbnail = document.querySelector(`.video-thumbnail[data-user="${userId}"]`);
                if (existingThumbnail) {
                    const video = existingThumbnail.querySelector('video');
                    video.srcObject = stream;
                    return;
                }
                
                const thumbnail = document.createElement('div');
                thumbnail.className = 'video-thumbnail';
                thumbnail.dataset.user = userId;
                
                const video = document.createElement('video');
                video.autoplay = true;
                video.playsInline = true;
                video.srcObject = stream;
                
                if (isLocal) {
                    video.muted = true;
                }
                
                const user = users.find(u => u.id === userId);
                const placeholder = document.createElement('div');
                placeholder.className = 'video-placeholder';
                placeholder.innerHTML = `
                    <div class="participant-avatar" style="background-color: ${user?.avatarColor || '#4a6bff'}">
                        ${user?.name.charAt(0).toUpperCase() || 'U'}
                    </div>
                    <p>${user?.name || 'User'}</p>
                `;
                
                thumbnail.appendChild(video);
                thumbnail.appendChild(placeholder);
                videoThumbnails.appendChild(thumbnail);
                
                // Show video when it starts playing
                video.onplaying = () => {
                    placeholder.style.display = 'none';
                };
            }

            // Start or stop recording
            function toggleRecording() {
                if (recording) {
                    stopRecording();
                } else {
                    startRecording();
                }
            }

            // Start recording
            function startRecording() {
                if (!canvas) return;
                
                recordedChunks = [];
                const stream = canvas.captureStream(30);
                mediaRecorder = new MediaRecorder(stream);
                
                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) {
                        recordedChunks.push(e.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    
                    // Create download link
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `whiteboard-recording-${new Date().toISOString()}.webm`;
                    a.click();
                };
                
                mediaRecorder.start();
                recording = true;
                updateRecordButton();
            }

            // Stop recording
            function stopRecording() {
                if (!mediaRecorder || !recording) return;
                
                mediaRecorder.stop();
                recording = false;
                updateRecordButton();
            }

            // Update record button UI
            function updateRecordButton() {
                const recordBtn = document.getElementById('recordBtn');
                if (recording) {
                    recordBtn.innerHTML = '<i class="fas fa-stop"></i><span>Stop Recording</span>';
                    recordBtn.style.backgroundColor = '#ff6b6b';
                    recordBtn.style.color = 'white';
                } else {
                    recordBtn.innerHTML = '<i class="fas fa-circle"></i><span>Record</span>';
                    recordBtn.style.backgroundColor = '';
                    recordBtn.style.color = '';
                }
            }

            // Export whiteboard
            function exportWhiteboard() {
                document.getElementById('exportModal').classList.add('active');
            }

            // Save whiteboard
            function saveWhiteboard() {
                document.getElementById('saveModal').classList.add('active');
            }

            // Load whiteboard
            function loadWhiteboard() {
                document.getElementById('loadModal').classList.add('active');
            }

            // Show invite modal
            function showInviteModal() {
                document.getElementById('inviteModal').classList.add('active');
            }

            // Show settings modal
            function showSettingsModal() {
                document.getElementById('settingsModal').classList.add('active');
            }

            // Show leave modal
            function showLeaveModal() {
                document.getElementById('leaveModal').classList.add('active');
            }

            // Toggle right panel
            function toggleRightPanel() {
                document.getElementById('rightPanel').classList.toggle('active');
            }

            // Toggle video
            function toggleVideo() {
                const videoControl = document.getElementById('toggleVideo');
                const videoTracks = localStream.getVideoTracks();
                
                if (videoTracks.length > 0) {
                    const isEnabled = videoTracks[0].enabled;
                    videoTracks[0].enabled = !isEnabled;
                    
                    videoControl.classList.toggle('active', !isEnabled);
                    document.getElementById('videoControl').querySelector('i').className = isEnabled ? 'fas fa-video-slash' : 'fas fa-video';
                }
            }

            // Toggle microphone
            function toggleMicrophone() {
                const micControl = document.getElementById('toggleMic');
                const audioTracks = localStream.getAudioTracks();
                
                if (audioTracks.length > 0) {
                    const isEnabled = audioTracks[0].enabled;
                    audioTracks[0].enabled = !isEnabled;
                    
                    micControl.classList.toggle('active', !isEnabled);
                    document.getElementById('micControl').querySelector('i').className = isEnabled ? 'fas fa-microphone-slash' : 'fas fa-microphone';
                }
            }

            // Toggle virtual background
            function toggleVirtualBackground() {
                // In a real app, this would apply virtual background using WebGL or similar
                alert('Virtual background feature would be implemented here with WebGL processing');
            }

            // End call
            function endCall() {
                if (localStream) {
                    localStream.getTracks().forEach(track => track.stop());
                }
                
                // Close peer connections
                Object.values(peerConnections).forEach(pc => pc.close());
                peerConnections = {};
                
                // Show exit screen
                document.getElementById('exitScreen').style.display = 'flex';
            }

            // Leave meeting
            function leaveMeeting() {
                endCall();
                
                if (document.getElementById('saveBeforeLeave').checked) {
                    saveWhiteboard();
                }
            }

            // Rejoin meeting
            function rejoinMeeting() {
                window.location.reload();
            }

            // Return to home
            function returnHome() {
                window.location.href = window.location.origin;
            }

            // Event Listeners
            document.getElementById('prevSlide').addEventListener('click', () => {
                if (currentSlideIndex > 0) {
                    saveCurrentSlide();
                    currentSlideIndex--;
                    loadSlide(currentSlideIndex);
                    updateSlideCounter();
                    renderSlideThumbnails();
                }
            });

            document.getElementById('nextSlide').addEventListener('click', () => {
                if (currentSlideIndex < slides.length - 1) {
                    saveCurrentSlide();
                    currentSlideIndex++;
                    loadSlide(currentSlideIndex);
                    updateSlideCounter();
                    renderSlideThumbnails();
                } else {
                    addNewSlide();
                }
            });

            document.getElementById('addSlide').addEventListener('click', addNewSlide);
            document.getElementById('duplicateSlide').addEventListener('click', () => {
                saveCurrentSlide();
                const currentSlide = slides[currentSlideIndex];
                const newSlide = JSON.parse(JSON.stringify(currentSlide));
                newSlide.id = 'slide-' + Date.now();
                slides.push(newSlide);
                currentSlideIndex = slides.length - 1;
                loadSlide(currentSlideIndex);
                updateSlideCounter();
                renderSlideThumbnails();
            });

            document.getElementById('recordBtn').addEventListener('click', toggleRecording);
            document.getElementById('exportBtn').addEventListener('click', exportWhiteboard);

            // Tool selection
            document.querySelectorAll('.tool[data-tool]').forEach(tool => {
                tool.addEventListener('click', () => {
                    document.querySelectorAll('.tool').forEach(t => t.classList.remove('active'));
                    tool.classList.add('active');
                    currentTool = tool.dataset.tool;
                    
                    // Update canvas drawing mode
                    canvas.isDrawingMode = (currentTool === 'pencil' || currentTool === 'eraser');
                    
                    // Special handling for eraser
                    if (currentTool === 'eraser') {
                        canvas.freeDrawingBrush = new fabric.EraserBrush(canvas);
                        canvas.freeDrawingBrush.width = currentSize;
                    } else if (currentTool === 'pencil') {
                        canvas.freeDrawingBrush = new fabric.PencilBrush(canvas);
                        canvas.freeDrawingBrush.color = currentColor;
                        canvas.freeDrawingBrush.width = currentSize;
                    }
                });
            });

            // Color selection
            document.querySelectorAll('.color-option').forEach(color => {
                color.addEventListener('click', () => {
                    document.querySelectorAll('.color-option').forEach(c => c.classList.remove('active'));
                    color.classList.add('active');
                    currentColor = color.dataset.color;
                    
                    if (currentTool === 'pencil') {
                        canvas.freeDrawingBrush.color = currentColor;
                    }
                });
            });

            // Size selection
            document.querySelectorAll('.size-option').forEach(size => {
                size.addEventListener('click', () => {
                    document.querySelectorAll('.size-option').forEach(s => s.classList.remove('active'));
                    size.classList.add('active');
                    currentSize = parseInt(size.dataset.size);
                    
                    if (currentTool === 'pencil' || currentTool === 'eraser') {
                        canvas.freeDrawingBrush.width = currentSize;
                    }
                });
            });

            // Clear board
            document.querySelector('.tool[data-tool="clear"]').addEventListener('click', () => {
                if (confirm('Are you sure you want to clear the current slide?')) {
                    canvas.clear();
                    canvas.backgroundColor = '#ffffff';
                    canvas.renderAll();
                }
            });

            // Save/Load
            document.querySelector('.tool[data-tool="save"]').addEventListener('click', saveWhiteboard);
            document.querySelector('.tool[data-tool="load"]').addEventListener('click', loadWhiteboard);

            // Close modals
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', () => {
                    btn.closest('.modal-overlay').classList.remove('active');
                });
            });

            document.getElementById('cancelSave').addEventListener('click', () => {
                document.getElementById('saveModal').classList.remove('active');
            });

            document.getElementById('confirmSave').addEventListener('click', () => {
                const fileName = document.getElementById('fileName').value || 'whiteboard';
                const format = document.querySelector('input[name="format"]:checked').value;
                
                let dataUrl, extension;
                if (format === 'pdf') {
                    // In a real app, you would generate a PDF
                    alert('PDF export would be implemented here with a PDF library');
                    return;
                } else {
                    dataUrl = canvas.toDataURL({
                        format: format,
                        quality: 0.9
                    });
                    extension = format;
                }
                
                const a = document.createElement('a');
                a.href = dataUrl;
                a.download = `${fileName}.${extension}`;
                a.click();
                
                document.getElementById('saveModal').classList.remove('active');
            });

            document.getElementById('cancelExport').addEventListener('click', () => {
                document.getElementById('exportModal').classList.remove('active');
            });

            document.getElementById('confirmExport').addEventListener('click', () => {
                const fileName = document.getElementById('exportFileName').value || 'whiteboard-export';
                const exportOption = document.querySelector('input[name="exportOption"]:checked').value;
                const format = document.querySelector('input[name="exportFormat"]:checked').value;
                
                if (exportOption === 'current') {
                    // Export current slide
                    let dataUrl, extension;
                    if (format === 'pdf') {
                        alert('PDF export would be implemented here with a PDF library');
                        return;
                    } else {
                        dataUrl = canvas.toDataURL({
                            format: format,
                            quality: 0.9
                        });
                        extension = format;
                    }
                    
                    const a = document.createElement('a');
                    a.href = dataUrl;
                    a.download = `${fileName}.${extension}`;
                    a.click();
                } else {
                    // Export all slides (would be implemented with a PDF library)
                    alert('Exporting all slides as a PDF would be implemented here');
                }
                
                document.getElementById('exportModal').classList.remove('active');
            });

            // Invite modal
            document.getElementById('inviteOption').addEventListener('click', showInviteModal);
            document.getElementById('cancelInvite').addEventListener('click', () => {
                document.getElementById('inviteModal').classList.remove('active');
            });
            document.getElementById('copyLink').addEventListener('click', () => {
                const linkInput = document.getElementById('meetingLink');
                linkInput.select();
                document.execCommand('copy');
                alert('Meeting link copied to clipboard!');
            });
            document.getElementById('copyId').addEventListener('click', () => {
                const idInput = document.getElementById('meetingId');
                idInput.select();
                document.execCommand('copy');
                alert('Meeting ID copied to clipboard!');
            });
            document.getElementById('sendInvite').addEventListener('click', () => {
                const email = document.getElementById('inviteEmail').value;
                if (email && email.includes('@')) {
                    alert(`Invitation sent to ${email}`);
                    document.getElementById('inviteEmail').value = '';
                } else {
                    alert('Please enter a valid email address');
                }
            });

            // Settings modal
            document.getElementById('settingsOption').addEventListener('click', showSettingsModal);
            document.getElementById('cancelSettings').addEventListener('click', () => {
                document.getElementById('settingsModal').classList.remove('active');
            });
            document.getElementById('saveSettings').addEventListener('click', () => {
                // Save settings (would be implemented in a real app)
                alert('Settings saved!');
                document.getElementById('settingsModal').classList.remove('active');
            });
            document.getElementById('requirePasscode').addEventListener('change', (e) => {
                document.getElementById('passcodeGroup').style.display = e.target.checked ? 'block' : 'none';
            });

            // Background options
            document.querySelectorAll('.background-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.background-option').forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    
                    if (option.dataset.background === 'custom') {
                        const input = document.createElement('input');
                        input.type = 'file';
                        input.accept = 'image/*';
                        input.onchange = (e) => {
                            const file = e.target.files[0];
                            if (file) {
                                const reader = new FileReader();
                                reader.onload = (event) => {
                                    option.style.backgroundImage = `url(${event.target.result})`;
                                    option.querySelector('i').style.display = 'none';
                                };
                                reader.readAsDataURL(file);
                            }
                        };
                        input.click();
                    }
                });
            });

            // Leave meeting
            document.getElementById('leaveOption').addEventListener('click', showLeaveModal);
            document.getElementById('cancelLeave').addEventListener('click', () => {
                document.getElementById('leaveModal').classList.remove('active');
            });
            document.getElementById('confirmLeave').addEventListener('click', leaveMeeting);

            // Exit screen
            document.getElementById('rejoinMeeting').addEventListener('click', rejoinMeeting);
            document.getElementById('returnHome').addEventListener('click', returnHome);

            // Video controls
            document.getElementById('toggleMic').addEventListener('click', toggleMicrophone);
            document.getElementById('toggleVideo').addEventListener('click', toggleVideo);
            document.getElementById('toggleBackground').addEventListener('click', toggleVirtualBackground);
            document.getElementById('endCall').addEventListener('click', endCall);

            // Bottom controls
            document.getElementById('micControl').addEventListener('click', toggleMicrophone);
            document.getElementById('videoControl').addEventListener('click', toggleVideo);
            document.getElementById('screenShareControl').addEventListener('click', () => {
                alert('Screen sharing would be implemented here with getDisplayMedia');
            });
            document.getElementById('participantsControl').addEventListener('click', toggleRightPanel);
            document.getElementById('raiseHandControl').addEventListener('click', () => {
                alert('Raise hand notification sent to participants');
            });
            document.getElementById('reactionsControl').addEventListener('click', () => {
                document.getElementById('reactionPicker').classList.toggle('show');
            });
            document.querySelectorAll('.reaction-option').forEach(reaction => {
                reaction.addEventListener('click', () => {
                    alert(`Reaction ${reaction.textContent} sent to participants`);
                    document.getElementById('reactionPicker').classList.remove('show');
                });
            });
            document.getElementById('moreControl').addEventListener('click', () => {
                document.getElementById('moreOptions').classList.toggle('show');
            });
            document.querySelectorAll('.option-item').forEach(option => {
                option.addEventListener('click', () => {
                    document.getElementById('moreOptions').classList.remove('show');
                });
            });

            // Toggle panel for mobile
            document.getElementById('togglePanel').addEventListener('click', toggleRightPanel);

            // Close modals when clicking outside
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });

            // Close reaction picker when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#reactionsControl') && !e.target.closest('#reactionPicker')) {
                    document.getElementById('reactionPicker').classList.remove('show');
                }
                
                if (!e.target.closest('#moreControl') && !e.target.closest('#moreOptions')) {
                    document.getElementById('moreOptions').classList.remove('show');
                }
            });

            // Window resize handler
            window.addEventListener('resize', () => {
                if (canvas) {
                    canvas.setDimensions({
                        width: document.querySelector('.whiteboard-area').offsetWidth,
                        height: document.querySelector('.whiteboard-area').offsetHeight
                    });
                }
            });

            // Before unload handler
            window.addEventListener('beforeunload', (e) => {
                if (recording) {
                    e.preventDefault();
                    e.returnValue = 'You are currently recording. Are you sure you want to leave?';
                    return e.returnValue;
                }
            });

            // Initialize the app
            initWhiteboard();
            initSocket();
            initWebRTC();
        });
    </script>
</body>
</html>
